
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skill Scan</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script type="importmap">
  {
    "imports": {
      "react": "https://aistudiocdn.com/react@^19.1.1",
      "react-dom/client": "https://aistudiocdn.com/react-dom@^19.1.1/client",
      "@google/genai": "https://aistudiocdn.com/@google/genai@^1.20.0",
      "recharts": "https://aistudiocdn.com/recharts@^2.12.7",
      "pdfjs-dist/build/pdf.min.mjs": "https://aistudiocdn.com/pdfjs-dist@^4.5.136/build/pdf.min.mjs",
      "jspdf": "https://aistudiocdn.com/jspdf@^2.5.1",
      "html2canvas": "https://aistudiocdn.com/html2canvas@^1.4.1"
    }
  }
  </script>
  <!-- Add Babel for in-browser JSX/TSX transpilation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root"></div>
  
  <script type="text/babel" data-presets="typescript,react" data-type="module">
    // All application code is now inside this single script tag.
    
    import React, { useState, useEffect, useMemo, useRef } from 'react';
    import ReactDOM from 'react-dom/client';
    import { GoogleGenAI, Type } from "@google/genai";
    import * as pdfjsLib from 'pdfjs-dist/build/pdf.min.mjs';
    import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell } from 'recharts';
    import jsPDF from 'jspdf';
    import html2canvas from 'html2canvas';

    //==================================================================
    // TYPES
    //==================================================================
    var FitVerdict;
    (function (FitVerdict) {
        FitVerdict["High"] = "High";
        FitVerdict["Medium"] = "Medium";
        FitVerdict["Low"] = "Low";
    })(FitVerdict || (FitVerdict = {}));

    //==================================================================
    // PDF PARSING UTILITY
    //==================================================================
    pdfjsLib.GlobalWorkerOptions.workerSrc = `https://aistudiocdn.com/pdfjs-dist@^4.5.136/build/pdf.worker.min.mjs`;

    const parseFileAsText = async (file) => {
        if (file.type !== 'application/pdf') {
            throw new Error('Invalid file type. Only PDF files are supported.');
        }
        const arrayBuffer = await file.arrayBuffer();
        try {
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let fullText = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => ('str' in item ? item.str : '')).join(' ');
                fullText += pageText + '\n\n';
            }
            return fullText;
        } catch (error) {
            console.error('Error parsing PDF:', error);
            throw new Error('Failed to parse the PDF file. It might be corrupted or password-protected.');
        }
    };
    
    //==================================================================
    // LOCAL STORAGE SERVICE
    //==================================================================
    const HISTORY_KEY = 'skill-scan-history';

    const getHistory = () => {
        try {
            const historyJson = localStorage.getItem(HISTORY_KEY);
            if (!historyJson) return [];
            const history = JSON.parse(historyJson);
            return history.map((item) => ({
                ...item,
                timestamp: new Date(item.timestamp),
            }));
        } catch (error) {
            console.error("Failed to parse history from localStorage:", error);
            return [];
        }
    };

    const addHistoryItem = (item) => {
        const history = getHistory();
        const newHistoryItem = {
            ...item,
            id: `hist_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`,
            timestamp: new Date(),
        };
        const updatedHistory = [newHistoryItem, ...history];
        localStorage.setItem(HISTORY_KEY, JSON.stringify(updatedHistory));
    };

    const clearHistory = () => {
        localStorage.removeItem(HISTORY_KEY);
    };

    //==================================================================
    // GEMINI SERVICE
    //==================================================================
    const ENCODED_API_KEY = "QUl6YVN5Q25CUmZhVF85cDdiWURkRW1USmFZYjhlTFJLXzgxarmr";
    const analysisSchema = {
        type: Type.OBJECT,
        properties: {
            candidateName: { type: Type.STRING, description: "The full name of the candidate as extracted from the resume. If no name is found, return 'N/A'." },
            relevanceScore: { type: Type.INTEGER, description: "A score from 0 to 100 representing how well the resume matches the job description." },
            fitVerdict: { type: Type.STRING, enum: ["High", "Medium", "Low"], description: "A verdict on the candidate's suitability for the role." },
            missingElements: { type: Type.ARRAY, description: "A list of key skills, technologies, or qualifications from the job description that are missing from the resume.", items: { type: Type.OBJECT, properties: { type: { type: Type.STRING, description: "The category of the missing element (e.g., 'Skill', 'Certification', 'Project')." }, details: { type: Type.STRING, description: "Specific details about the missing element." } }, required: ["type", "details"] } },
            feedback: { type: Type.STRING, description: "Concise, actionable feedback for the student on how to improve their resume for this specific role. This should be constructive and encouraging." },
            jobTitleSuggestions: { type: Type.ARRAY, description: "A list of suggestions for non-standard job titles found in the resume. If no non-standard titles are found, this should be an empty array.", items: { type: Type.OBJECT, properties: { original: { type: Type.STRING, description: "The original, non-standard job title found in the resume (e.g., 'Software Ninja')." }, suggestion: { type: Type.STRING, description: "The suggested standard or more common job title (e.g., 'Software Engineer')." } }, required: ["original", "suggestion"] } },
            achievementImpacts: { type: Type.ARRAY, description: "An analysis of key achievement bullet points from the resume, estimating their real-world impact and flagging exaggeration. If no achievements are found, this should be an empty array.", items: { type: Type.OBJECT, properties: { achievementText: { type: Type.STRING, description: "The original achievement bullet point text from the resume." }, estimatedImpact: { type: Type.STRING, description: "A realistic, quantified or qualified estimation of the achievement's impact (e.g., 'Likely a 5-10% efficiency improvement', 'Represents a standard project completion')." }, justification: { type: Type.STRING, description: "A brief justification for the estimated impact, explaining why it's realistic or potentially inflated." } }, required: ["achievementText", "estimatedImpact", "justification"] } }
        },
        required: ["candidateName", "relevanceScore", "fitVerdict", "missingElements", "feedback", "jobTitleSuggestions", "achievementImpacts"],
    };

    const analyzeResume = async (resumeText, jobDescription, language) => {
        const apiKey = atob(ENCODED_API_KEY);
        if (!apiKey) throw new Error("API key is missing or could not be decoded.");
        const ai = new GoogleGenAI({ apiKey });
        const prompt = `You are an expert AI-powered resume evaluation engine named Skill Scan. Your task is to analyze a candidate's resume against a provided job description. Job Description: --- ${jobDescription} --- Candidate's Resume: --- ${resumeText} --- Strictly follow these instructions: 1. Identify and extract the full name of the candidate from the resume text. Return it as 'candidateName'. If a name cannot be clearly identified, return 'N/A'. 2. Calculate a 'Relevance Score' from 0 to 100 representing the match between the resume and the job description. 3. Provide a 'Fit Verdict' which must be one of 'High', 'Medium', or 'Low'. 4. Identify 'Missing Elements' from the resume based on the job description. 5. Generate concise, actionable 'Feedback' for the student on how to improve their resume. 6. Analyze the job titles listed in the resume. Identify any unconventional titles and suggest a standard equivalent in 'jobTitleSuggestions'. If none, return an empty array. 7. Scrutinize achievement-oriented statements. Estimate the real-world impact and provide a justification in 'achievementImpacts'. If none, return an empty array. 8. IMPORTANT: The entire response, especially feedback and details, MUST be in ${language}. You MUST return your analysis in a JSON format that strictly adheres to the provided schema. Do not include any text or markdown outside of the JSON structure.`;
        try {
            const response = await ai.models.generateContent({ model: "gemini-2.5-flash", contents: prompt, config: { responseMimeType: "application/json", responseSchema: analysisSchema } });
            const result = JSON.parse(response.text.trim());
            if (!result.jobTitleSuggestions) result.jobTitleSuggestions = [];
            if (!result.achievementImpacts) result.achievementImpacts = [];
            if (!result.candidateName) result.candidateName = 'N/A';
            return result;
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            if (error instanceof Error && error.message.includes('API key not valid')) throw new Error("The embedded API key is not valid. Please contact the developer.");
            throw new Error("Failed to get analysis from Gemini API.");
        }
    };
    
    //==================================================================
    // ICONS
    //==================================================================
    const SparklesIcon = (props) => ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" {...props}> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.898 20.562L16.25 22.5l-.648-1.938a2.25 2.25 0 01-1.476-1.476L12 18.75l1.938-.648a2.25 2.25 0 011.476-1.476L17.25 15l.648 1.938a2.25 2.25 0 011.476 1.476L21 18.75l-1.938.648a2.25 2.25 0 01-1.476 1.476z" /> </svg> );
    const DocumentIcon = (props) => ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" {...props}> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /> </svg> );
    const BriefcaseIcon = (props) => ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" {...props}> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /> </svg> );

    //==================================================================
    // SIMPLE COMPONENTS
    //==================================================================
    const Button = ({ children, ...props }) => ( <button {...props} className="inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-full shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-slate-400 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200"> {children} </button> );
    const Spinner = () => ( <svg className="animate-spin h-10 w-10 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle> <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path> </svg> );
    
    //==================================================================
    // COMPLEX COMPONENTS (Defined in dependency order)
    //==================================================================
    const Header = ({ theme, setTheme, onNavigate }) => {
        const toggleTheme = () => setTheme(theme === 'light' ? 'dark' : 'light');
        const SunIcon = (props) => ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}> <path strokeLinecap="round" strokeLinejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" /> </svg> );
        const MoonIcon = (props) => ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}> <path strokeLinecap="round" strokeLinejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" /> </svg> );
        return (
            <header className="bg-white dark:bg-slate-800 shadow-sm dark:border-b dark:border-slate-700 sticky top-0 z-10">
                <div className="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
                    <div className="flex items-center justify-between">
                        <button onClick={() => onNavigate('analyzer')} className="flex items-center focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 rounded-lg p-1 -ml-1">
                            <SparklesIcon className="h-8 w-8 text-indigo-600 dark:text-indigo-400 mr-3" />
                            <h1 className="text-3xl font-bold leading-tight text-slate-900 dark:text-slate-50">Skill Scan</h1>
                        </button>
                        <div className="flex items-center gap-4">
                            <button onClick={() => onNavigate('about')} className="px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-200 bg-slate-100 dark:bg-slate-700 rounded-md hover:bg-slate-200 dark:hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">About Us</button>
                            <button onClick={toggleTheme} className="p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" aria-label={`Switch to ${theme === 'light' ? 'dark' : 'light'} mode`}>
                                {theme === 'light' ? <MoonIcon className="w-6 h-6" /> : <SunIcon className="w-6 h-6" />}
                            </button>
                        </div>
                    </div>
                    <p className="text-center text-slate-500 dark:text-slate-400 mt-2">Instantly scan your resume against any job description.</p>
                </div>
            </header>
        );
    };

    const ResumeUpload = ({ onFileSelect, selectedFiles, isParsing }) => {
        const fileInputRef = useRef(null);
        const [fileCount, setFileCount] = useState('1');
        const [error, setError] = useState(null);
        const UploadIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" {...props}><path strokeLinecap="round" strokeLinejoin="round" d="M12 16.5V9.75m0 0l-3.75 3.75M12 9.75l3.75 3.75M3 17.25V6.75A2.25 2.25 0 015.25 4.5h13.5A2.25 2.25 0 0121 6.75v10.5A2.25 2.25 0 0118.75 19.5H5.25A2.25 2.25 0 013 17.25z" /></svg>);
        const handleFileCountChange = (e) => {
            const { value } = e.target;
            if (value === '' || parseInt(value, 10) > 0) {
                setFileCount(value);
                setError(null);
                if (selectedFiles.length > 0) onFileSelect([]);
            }
        };
        const processFiles = (files) => {
            if (!files) return;
            const fileArray = Array.from(files);
            const expectedCount = parseInt(fileCount, 10);
            if (isNaN(expectedCount) || expectedCount <= 0) {
                setError('Please enter a valid number of files (1 or more).');
                return;
            }
            if (fileArray.length !== expectedCount) {
                setError(`Please select exactly ${expectedCount} file(s). You selected ${fileArray.length}.`);
                if (selectedFiles.length > 0) onFileSelect([]);
                return;
            }
            setError(null);
            onFileSelect(fileArray);
        };
        return (
            <div>
                <label className="flex items-center text-lg font-semibold text-slate-700 dark:text-slate-200"><DocumentIcon className="w-6 h-6 mr-2 text-slate-500 dark:text-slate-400" />Upload Resume(s)</label>
                <p className="text-sm text-slate-500 dark:text-slate-400 mt-1 mb-4">Specify how many resumes you want to analyze, then upload the files.</p>
                <div className="mb-4">
                    <label htmlFor="num-resumes" className="block text-sm font-medium text-slate-700 dark:text-slate-300">Number of Resumes</label>
                    <input type="number" id="num-resumes" value={fileCount} onChange={handleFileCountChange} min="1" className="mt-1 block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"/>
                </div>
                <div onClick={() => fileInputRef.current?.click()} onDrop={(e) => { e.preventDefault(); processFiles(e.dataTransfer.files); }} onDragOver={(e) => e.preventDefault()} className="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-slate-300 dark:border-slate-600 border-dashed rounded-md cursor-pointer hover:border-indigo-500">
                    <div className="space-y-1 text-center">
                        <UploadIcon className="mx-auto h-12 w-12 text-slate-400" />
                        <div className="flex text-sm text-slate-600 dark:text-slate-300">
                            <span className="relative font-medium text-indigo-600 dark:text-indigo-400"><span>{selectedFiles.length > 0 ? 'Replace files' : `Upload ${fileCount || '...'} file(s)`}</span><input ref={fileInputRef} type="file" className="sr-only" accept=".pdf" onChange={(e) => processFiles(e.target.files)} multiple /></span>
                            <p className="pl-1">or drag and drop</p>
                        </div>
                        <p className="text-xs text-slate-500 dark:text-slate-400">PDF only</p>
                    </div>
                </div>
                {error && <div className="mt-3 text-sm text-red-600 bg-red-50 p-3 rounded-md border border-red-200 dark:bg-red-900/20 dark:text-red-400">{error}</div>}
                {isParsing && <div className="mt-4 text-sm flex items-center"><Spinner /> Parsing PDFs...</div>}
                {selectedFiles.length > 0 && !isParsing && (
                    <div className="mt-4 space-y-2">
                        <p className="text-sm font-medium">{selectedFiles.length} file(s) ready for analysis:</p>
                        <ul className="max-h-32 overflow-y-auto space-y-1 bg-green-50 text-green-800 p-3 rounded-md border border-green-200 dark:bg-green-900/20 dark:text-green-300">
                            {selectedFiles.map(file => (<li key={file.name} className="flex items-center text-sm"><DocumentIcon className="w-4 h-4 mr-2" />{file.name}</li>))}
                        </ul>
                    </div>
                )}
            </div>
        );
    };

    const JobDescriptionInput = ({ onJdChange, language, setLanguage }) => {
        const [jdText, setJdText] = useState('');
        return (
          <div>
            <div className="flex items-center text-lg font-semibold text-slate-700 dark:text-slate-200">
                <BriefcaseIcon className="w-6 h-6 mr-2 text-slate-500 dark:text-slate-400" />
                <h2>Job Description</h2>
            </div>
            <p className="text-sm text-slate-500 dark:text-slate-400 mt-1 mb-4">Paste the job description below.</p>
            <textarea
                rows="10"
                className="w-full p-3 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-50"
                placeholder="Paste the full job description here..."
                onChange={(e) => onJdChange(e.target.value)}
            ></textarea>
            <div className="mt-4">
                <label htmlFor="analysis-language" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Feedback Language</label>
                <select id="analysis-language" value={language} onChange={(e) => setLanguage(e.target.value)} className="block w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 sm:text-sm">
                    {['English', 'Spanish', 'French', 'German', 'Japanese', 'Mandarin Chinese', 'Portuguese'].map(lang => <option key={lang} value={lang}>{lang}</option>)}
                </select>
            </div>
          </div>
        );
    };

    const AnalysisResult = ({ data }) => {
        const reportRef = useRef(null);
        const [isDownloading, setIsDownloading] = useState(false);
        const getVerdictClass = (verdict) => {
            switch (verdict) {
                case FitVerdict.High: return 'bg-green-100 text-green-800 dark:bg-green-500/20 dark:text-green-300';
                case FitVerdict.Medium: return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-500/20 dark:text-yellow-300';
                case FitVerdict.Low: return 'bg-red-100 text-red-800 dark:bg-red-500/20 dark:text-red-300';
                default: return 'bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-200';
            }
        };
        const getScoreColor = (score) => {
            if (score >= 75) return 'text-green-600 dark:text-green-400';
            if (score >= 50) return 'text-yellow-600 dark:text-yellow-400';
            return 'text-red-600 dark:text-red-400';
        };
        const ScoreGauge = ({ score }) => { /* ... gauge SVG ... */ return <div className="relative w-32 h-32"><svg className="w-full h-full" viewBox="0 0 100 100"><circle className="text-slate-200 dark:text-slate-700" strokeWidth="10" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" /><circle strokeWidth="10" strokeDasharray={2 * Math.PI * 45} strokeDashoffset={(2 * Math.PI * 45) - (score / 100) * (2 * Math.PI * 45)} strokeLinecap="round" stroke={score >= 75 ? '#22c55e' : score >= 50 ? '#f59e0b' : '#ef4444'} fill="transparent" r="45" cx="50" cy="50" className="-rotate-90 origin-center" /></svg><div className={`absolute inset-0 flex items-center justify-center text-3xl font-bold ${getScoreColor(score)}`}>{score}</div></div>; };
        const handleDownloadPdf = async () => { /* ... PDF generation logic ... */ setIsDownloading(true); try { const canvas = await html2canvas(reportRef.current, { scale: 2, useCORS: true, backgroundColor: document.documentElement.classList.contains('dark') ? '#1e293b' : '#ffffff' }); const pdf = new jsPDF({ orientation: 'p', unit: 'px', format: 'a4', hotfixes: ['px_scaling'] }); const pdfWidth = pdf.internal.pageSize.getWidth(); const scaledHeight = canvas.height / (canvas.width / pdfWidth); pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, pdfWidth, scaledHeight); pdf.save(`SkillScan_Analysis_${data.candidateName || 'Report'}.pdf`); } catch(e) { console.error(e); alert("Failed to generate PDF.") } finally { setIsDownloading(false); } };
        return (
            <div className="w-full animate-fade-in">
                <div className="flex justify-between items-center mb-6">
                    <h2 className="text-2xl font-bold text-slate-800 dark:text-slate-100">Analysis for {data.candidateName || "Candidate"}</h2>
                    <button onClick={handleDownloadPdf} disabled={isDownloading} className="flex items-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 disabled:bg-slate-400">{isDownloading ? 'Downloading...' : 'Download PDF'}</button>
                </div>
                <div ref={reportRef} className="p-4 bg-white dark:bg-slate-800 space-y-6">
                    <div className="flex items-center justify-center gap-6 p-4 bg-slate-100 dark:bg-slate-700/50 rounded-lg">
                        <div className="flex flex-col items-center"><span className="text-sm font-medium text-slate-600 dark:text-slate-300">Relevance Score</span><ScoreGauge score={data.relevanceScore} /></div>
                        <div className="flex flex-col items-center"><span className="text-sm font-medium text-slate-600 dark:text-slate-300">Fit Verdict</span><span className={`px-4 py-1.5 text-lg font-semibold rounded-full ${getVerdictClass(data.fitVerdict)}`}>{data.fitVerdict}</span></div>
                    </div>
                    {data.jobTitleSuggestions?.length > 0 && <div><h3 className="text-lg font-semibold">Job Title Suggestions</h3><ul>{data.jobTitleSuggestions.map((item, i) => <li key={i}>{item.original} → {item.suggestion}</li>)}</ul></div>}
                    {data.achievementImpacts?.length > 0 && <div><h3 className="text-lg font-semibold">Achievement Impact Analysis</h3>{data.achievementImpacts.map((item, i) => <div key={i}><p>"{item.achievementText}"</p><p><b>Impact:</b> {item.estimatedImpact}</p><p><b>Justification:</b> {item.justification}</p></div>)}</div>}
                    <div><h3 className="text-lg font-semibold">Missing Elements</h3>{data.missingElements.length > 0 ? <ul>{data.missingElements.map((item, i) => <li key={i}><b>{item.type}:</b> {item.details}</li>)}</ul> : <p>No significant gaps found.</p>}</div>
                    <div><h3 className="text-lg font-semibold">Personalized Feedback</h3><p>{data.feedback}</p></div>
                </div>
            </div>
        );
    };
    
    const AnalysisHistory = ({ theme, history, onSelectItem, onClearHistory, selectedId, sortOption, onSortChange, filterVerdicts, onFilterChange, onClearFilters }) => {
        const CustomTooltip = ({ active, payload, label }) => { if (active && payload?.length) { return <div className="p-2 bg-white dark:bg-slate-800 border rounded-md shadow-lg"><p>{`Score Range: ${label}`}</p><p>{`Analyses: ${payload[0].value}`}</p></div>; } return null; };
        const chartData = useMemo(() => { const brackets = Array(10).fill(0).map((_, i) => ({ name: `${i*10+1}-${(i+1)*10}`, count: 0 })); history.forEach(item => { const score = item.result.relevanceScore; if (score > 0) { const index = Math.min(Math.floor((score - 1) / 10), 9); brackets[index].count++; } }); return brackets; }, [history]);
        return (
            <div className="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                <div className="flex justify-between mb-4">
                    <h2 className="text-xl font-bold">Analysis History</h2>
                    <button onClick={onClearHistory} className="text-sm text-red-600">Clear History</button>
                </div>
                <div className="w-full h-52 mb-6">
                    <ResponsiveContainer width="100%" height="100%">
                        <BarChart data={chartData}><CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="name" /><YAxis allowDecimals={false} /><Tooltip content={<CustomTooltip />} /><Bar dataKey="count"><Cell fill="#ef4444" /><Cell fill="#ef4444" /><Cell fill="#ef4444" /><Cell fill="#ef4444" /><Cell fill="#f59e0b" /><Cell fill="#f59e0b" /><Cell fill="#22c55e" /><Cell fill="#22c55e" /><Cell fill="#22c55e" /><Cell fill="#22c55e" /></Bar></BarChart>
                    </ResponsiveContainer>
                </div>
                {/* Sort and Filter UI would go here */}
                <ul className="space-y-3 max-h-96 overflow-y-auto">
                    {history.map(item => (<li key={item.id}><button onClick={() => onSelectItem(item.id)} className={`w-full text-left p-4 rounded-lg border ${item.id === selectedId ? 'bg-indigo-50 border-indigo-400' : 'bg-slate-50 border-slate-200'}`}>...</button></li>))}
                </ul>
            </div>
        );
    };

    const AboutUs = () => {
        const teamMembers = [ { name: 'Nagasudhan T', linkedin: 'https://www.linkedin.com/in/naga-sudhan-36bb88339/' }, { name: 'Sankarapandian A' }, { name: 'Prajith S' }, ];
        return (
            <div className="bg-white dark:bg-slate-800 p-8 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                <h2 className="text-3xl font-bold text-center mb-8">About Us</h2>
                <p className="mb-4">We are a team of passionate developers — Nagasudhan T, Sankarapandian A, and Prajith S — who came together to solve a real challenge faced by companies during recruitment.</p>
                <p className="mb-8">Our project, the Resume Evaluator App, is designed to simplify and speed up the hiring process by automatically analyzing and evaluating resumes... Our goal is to bring efficiency, accuracy, and ease to recruitment...</p>
                <h3 className="text-2xl font-semibold text-center mb-4">Meet the Team</h3>
                <div className="grid grid-cols-1 sm:grid-cols-3 gap-6">
                    {teamMembers.map((member) => (
                        <div key={member.name} className="text-center p-6 bg-slate-50 dark:bg-slate-700 rounded-lg">
                            {member.linkedin ? <a href={member.linkedin} target="_blank" rel="noopener noreferrer" className="text-lg font-semibold text-indigo-600 dark:text-indigo-400 hover:underline">{member.name}</a> : <p className="text-lg font-semibold">{member.name}</p>}
                        </div>
                    ))}
                </div>
            </div>
        );
    };

    //==================================================================
    // MAIN APP COMPONENT
    //==================================================================
    const App = () => {
        const [currentView, setCurrentView] = useState('analyzer');
        const [theme, setTheme] = useState(() => localStorage.getItem('theme') || 'light');
        const [language, setLanguage] = useState('English');
        const [resumeFiles, setResumeFiles] = useState([]);
        const [resumeTexts, setResumeTexts] = useState([]);
        const [jdText, setJdText] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [isParsingResumes, setIsParsingResumes] = useState(false);
        const [error, setError] = useState(null);
        const [analysisResults, setAnalysisResults] = useState(null);
        const [viewedAnalysisResult, setViewedAnalysisResult] = useState(null);
        const [history, setHistory] = useState([]);
        const [selectedHistoryId, setSelectedHistoryId] = useState(null);

        useEffect(() => {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            }
        }, [theme]);

        useEffect(() => {
            setHistory(getHistory());
        }, []);

        const handleNavigate = (view) => {
            setCurrentView(view);
            setAnalysisResults(null);
            setViewedAnalysisResult(null);
        };

        const handleResumeSelect = async (files) => {
            setResumeFiles(files);
            setIsParsingResumes(true);
            setError(null);
            try {
                const texts = await Promise.all(files.map(parseFileAsText));
                setResumeTexts(texts);
            } catch (err) {
                setError(err.message);
                setResumeFiles([]);
                setResumeTexts([]);
            } finally {
                setIsParsingResumes(false);
            }
        };
        
        const handleAnalyze = async () => {
            if (resumeTexts.length === 0 || !jdText) {
                setError('Please upload at least one resume and provide a job description.');
                return;
            }
            setIsLoading(true);
            setError(null);
            setAnalysisResults(null);
            setViewedAnalysisResult(null);
            try {
                const results = await Promise.all(resumeTexts.map((text, i) => 
                    analyzeResume(text, jdText, language).then(result => ({
                        resumeFileName: resumeFiles[i].name,
                        result
                    }))
                ));
                results.sort((a, b) => b.result.relevanceScore - a.result.relevanceScore);
                setAnalysisResults(results);
                results.forEach(({ resumeFileName, result }) => addHistoryItem({
                    resumeFileName,
                    jdFileName: "Custom JD",
                    result,
                    candidateName: result.candidateName,
                }));
                setHistory(getHistory());
            } catch (err) {
                setError(err.message);
            } finally {
                setIsLoading(false);
            }
        };

        const handleSelectHistoryItem = (id) => {
            const item = history.find(h => h.id === id);
            if (item) {
                setSelectedHistoryId(id);
                setViewedAnalysisResult(item.result);
                setAnalysisResults(null);
            }
        };
        
        return (
            <div className="bg-slate-50 dark:bg-slate-900 min-h-screen font-sans">
                <Header theme={theme} setTheme={setTheme} onNavigate={handleNavigate} />
                <main className="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
                    {currentView === 'analyzer' ? (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-1 space-y-8">
                                <div className="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                                    <ResumeUpload onFileSelect={handleResumeSelect} selectedFiles={resumeFiles} isParsing={isParsingResumes} />
                                </div>
                                <div className="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                                    <JobDescriptionInput onJdChange={setJdText} language={language} setLanguage={setLanguage} />
                                </div>
                                <div className="text-center">
                                    <Button onClick={handleAnalyze} disabled={resumeFiles.length === 0 || !jdText || isLoading}>
                                        {isLoading ? 'Analyzing...' : 'Analyze Now'}
                                    </Button>
                                </div>
                            </div>
                            <div className="lg:col-span-2 space-y-8">
                                {history.length > 0 && <AnalysisHistory history={history} onSelectItem={handleSelectHistoryItem} onClearHistory={() => { clearHistory(); setHistory([]); }} selectedId={selectedHistoryId} theme={theme} />}
                                <div className="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 min-h-[300px] flex items-center justify-center">
                                    {isLoading && <div className="text-center"><Spinner /><p>Analyzing...</p></div>}
                                    {error && <div className="text-red-600"><h3>Error</h3><p>{error}</p></div>}
                                    {!isLoading && !error && analysisResults && (
                                        <div className="w-full space-y-4">
                                            <h2 className="text-2xl font-bold text-center">Analysis Complete</h2>
                                            {analysisResults.map(({ resumeFileName, result }, index) => (
                                                <div key={index} className="p-4 border rounded-lg">
                                                    <h3 className="font-bold">Candidate: {result.candidateName}</h3>
                                                    <p className="text-sm">File: {resumeFileName}</p>
                                                    <AnalysisResult data={result} />
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    {!isLoading && !error && !analysisResults && viewedAnalysisResult && <AnalysisResult data={viewedAnalysisResult} />}
                                    {!isLoading && !error && !analysisResults && !viewedAnalysisResult && <div className="text-center"><h2 className="text-xl font-semibold">Ready to Analyze</h2><p>Upload a resume and job description to get started.</p></div>}
                                </div>
                            </div>
                        </div>
                    ) : (
                        <AboutUs />
                    )}
                </main>
            </div>
        );
    };

    //==================================================================
    // RENDER THE APP
    //==================================================================
    const rootElement = document.getElementById('root');
    if (!rootElement) {
      throw new Error("Could not find root element to mount to");
    }
    const root = ReactDOM.createRoot(rootElement);
    root.render(<App />);

  </script>
</body>
</html>
